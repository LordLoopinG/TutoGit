<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="UTF-8">
    <title>Seb Network</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>


</head>
<body class="bg-dark h-100">

    <div class="row h-100" id="myDiv">
        <form class="m-auto" id="formLogin">
            <input type="text" value="Pseudo" id="pseudo"><br>
            <input type="password" value="Mot de passe" id="MdP"><br>
            <input type="submit" value="Connexion"><br>
            <input type="button" value="Nouvel utilisateur" id="newUser">   
        </form>
    </div>

<script>
$(document).ready(function () {

/*JSON 1 User

var allUsers = {
    user : [{idUser : 1,
            pseudo : "zlatan",
            mdp : "123456"
            },
            {idUser : 2,
            pseudo : "marco",
            mpd : "654321"}]
}

//JSON 2 Post

var allPosts = {
    post : [{idPost : 1,
            idAuteur : 1,                    // =idUser
            date : "21/01/2021",
            url : "url de l'image",          //verif a faire lors de la soumission, au moins url ou text (sinon post vide!)
            text : "ceci est mon 1er post",
            likes : [1,3,...,7],             //correspond a l'idUser qui a like
            coms : [{idUser : 2,
                    dateCom : "21/01/2021",
                    contenuCom : "J'adore ton post"}]
    }]
}
*/

//Declaration des variables

    //recup de JSON USERS
    var monJsonUsers
    if (!localStorage.getItem("localUsers")) {
        monJsonUsers = {"jsonUsers" : []}
    }else{
        monJsonUsers = JSON.parse(localStorage.getItem("localUsers"))
    }

    //recup de JSON POSTS
    var monJsonPosts
    if (!localStorage.getItem("localPosts")) {
        monJsonPosts = {"jsonPosts" : []}
    }else{
        monJsonPosts = JSON.parse(localStorage.getItem("localPosts"))
    }

// Chargement de la Page d'accueil

// Fonction Inscription

    $("#newUser").click(function () {
        $("#myDiv").html(`
        <form class="m-auto" id="formInscription">
            <input type="text" placeholder="Pseudo" id="newPseudo"><br>
            <input type="password" placeholder="Mot de passe" id="newMdP"><br>
            <input type="password" placeholder="Mot de passe" id="newMdP2"><br>
            <input type="submit" value="Inscription">
        </form>
        `)

        //verifications

        $("#formInscription").submit(function(event) {
            event.preventDefault();
            if ( $("#newPseudo").val() == "" || $("#newMdP").val() == "" || $("#newMdP2").val() == "") {    //verif que tous les champs sont remplis
                alert("Merci de completer tous les champs")
            }else{            
                //verif pseudo dispo
                if (monJsonUsers.jsonUsers.length == 0) {
                    //on va créer l'user directement puisque il y'en a aucun donc pas besoin de verif particuliere a part le mot de passe et la confirmation
                    if ( $("#newMdP").val() != $("#newMdP2").val()) {                                       //verif que les 2 MdP sont identiques
                            alert("Mot de passe incorrecte")
                        }else{
                            alert("Inscription terminée. Bienvenu sur meilleur réseau social anomyne. Petit rappel : c'est pas parce c'est anomyme que c'est freestyle, vous êtes responsable de vos publications")
                            newId = 1
                            objNewUser = {"id" : newId , "pseudo" : $("#newPseudo").val(), "MdP" : $("#newMdP").val()}
                            monJsonUsers.jsonUsers.push(objNewUser)
                            localStorage.setItem("localUsers", JSON.stringify(monJsonUsers))
                            alert ("Welcome")
                        }
                }else{
                    //on va créer l'user APRES Verification
                    let x
                    for(x in monJsonUsers.jsonUsers) {
                        let monUser = monJsonUsers.jsonUsers[x]

                        if ( $("#newPseudo").val() == monUser.pseudo) {
                            alert("Pseudo déja existant, prends-en un autre !")
                        }else if ( $("#newMdP").val() != $("#newMdP2").val()) {                                       //verif que les 2 MdP sont identiques
                            alert("Mot de passe incorrecte")
                        }else{
                            alert("Inscription terminée. Bienvenu sur meilleur réseau social anomyne. Petit rappel : c'est pas parce c'est anomyme que c'est freestyle, vous êtes responsable de vos publications")
                            newId = monJsonUsers.jsonUsers[monJsonUsers.jsonUsers.length -1].id +1
                            objNewUser = {"id" : newId , "pseudo" : $("#newPseudo").val(), "MdP" : $("#newMdP").val()}
                            monJsonUsers.jsonUsers.push(objNewUser)
                            localStorage.setItem("localUsers", JSON.stringify(monJsonUsers))
                            alert ("Welcome")
                        }
                    }
                }
            }
        })
    })
                
//Fonction LOGIN  

    $("#formLogin").submit(function(event) {
                event.preventDefault


    })


})
    
</script>
</body>
</html>